<!DOCTYPE html>
<html>
<head>
<title>readme</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.pl-c {
    color: #969896;
}

.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {
    color: #0086b3;
}

.pl-e,.pl-en {
    color: #795da3;
}

.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {
    color: #333;
}

.pl-ent {
    color: #63a35c;
}

.pl-k,.pl-s,.pl-st {
    color: #a71d5d;
}

.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {
    color: #df5000;
}

.pl-id {
    color: #b52a1d;
}

.pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
}

.pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
}

.pl-ml {
    color: #693a17;
}

.pl-mh,.pl-mh .pl-en,.pl-ms {
    color: #1d3e81;
    font-weight: bold;
}

.pl-mq {
    color: #008080;
}

.pl-mi {
    color: #333;
    font-style: italic;
}

.pl-mb {
    color: #333;
    font-weight: bold;
}

.pl-md,.pl-mdhf {
    background-color: #ffecec;
    color: #bd2c00;
}

.pl-mdht,.pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
}

.pl-mdr {
    color: #795da3;
    font-weight: bold;
}

.pl-mo {
    color: #1d3e81;
}
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>
</head>
<body>
<p><a name="HOLTitle"></a></p>
<h1>Using Azure Cosmos DB and the DocumentDB API</h1>
<hr>
<p><a name="Overview"></a></p>
<h2>Overview</h2>
<p>Whether it targets businesses, consumers, or both, an app is only as meaningful as the data that drives it. With consumer and organizational requirements changing constantly, as well as the need to store, index, and optimize data and structures as they change, the need for a more open, flexible, and schema-agnostic data solution has been become essential. Azure Cosmos DB addresses this need and more and makes it easy to adjust and adapt data models on the fly, as business logic and application scenarios change.</p>
<p><a href="https://azure.microsoft.com/services/cosmos-db/">Azure Cosmos DB</a> is Microsoft's globally distributed, multi-model database service for mission-critical applications. It supports turn-key global distribution, elastic scaling of throughput and storage worldwide, single-digit millisecond latencies at the 99th percentile, five well-defined consistency levels, and guaranteed high availability, all backed by industry-leading SLAs. Azure Cosmos DB automatically indexes data without requiring you to deal with schema and index management. It is multi-model and supports document, key-value, graph, and columnar data models.</p>
<p><a href="https://docs.microsoft.com/azure/cosmos-db/documentdb-introduction">DocumentDB</a> is a feature of Cosmos DB implementing a fully managed NoSQL database service built for fast performance, high availability, elastic scaling, and ease of development. As a schema-free NoSQL database, DocumentDB provides rich and familiar SQL query capabilities over JSON data, ensuring that 99% of your reads are served under 10 milliseconds and 99% of your writes are served under 15 milliseconds. These unique benefits make DocumentDB a great fit for Web, mobile, gaming, IoT, and many other applications that need seamless scale and global replication.</p>
<p>In this lab, you will deploy a DocumentDB database under Cosmos DB to store customer and product order information for the fictitious company <em>Adventure Works</em>, and you will connect it to Azure Search to index the data and implement auto-suggest. You will also write a Web app that uses the database and demonstrates how easily applications can consume data from DocumentDB.</p>
<p><a name="Objectives"></a></p>
<h3>Objectives</h3>
<p>In this hands-on lab, you will learn how to:</p>
<ul>
<li>Create an Azure Cosmos DB account</li>
<li>Create DocumentDB collections and populate them with documents</li>
<li>Create an Azure Search service and and use it to index DocumentDB data</li>
<li>Access DocumentDB collections from your apps</li>
<li>Query the Azure Search service connected to a DocumentDB database</li>
</ul>
<p><a name="Prerequisites"></a></p>
<h3>Prerequisites</h3>
<p>The following are required to complete this hands-on lab:</p>
<ul>
<li>An active Microsoft Azure subscription. If you don't have one, <a href="https://azure.microsoft.com/en-us/free/">sign up for a free trial</a>.</li>
<li><a href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">Visual Studio 2017 Community edition</a> or higher with the "ASP.NET and web development" and "Azure development" workloads installed</li>
</ul>
<hr>
<p><a name="Exercises"></a></p>
<h2>Exercises</h2>
<p>This hands-on lab includes the following exercises:</p>
<ul>
<li><a href="#Exercise1">Exercise 1: Create a Cosmos DB account</a></li>
<li><a href="#Exercise2">Exercise 2: Create a DocumentDB database and collections</a></li>
<li><a href="#Exercise3">Exercise 3: Populate collections with documents</a></li>
<li><a href="#Exercise4">Exercise 4: Connect Azure Search</a></li>
<li><a href="#Exercise5">Exercise 5: Build a Web app</a></li>
<li><a href="#Exercise6">Exercise 6: Add auto-suggest</a></li>
</ul>
<p>Estimated time to complete this lab: <strong>60</strong> minutes.</p>
<p><a name="Exercise1"></a></p>
<h2>Exercise 1: Create a Cosmos DB account</h2>
<p>The first step in working with DocumentDB is to create a Cosmos DB account to hold databases, collections, and documents. In this exercise, you will create a Cosmos DB account using the Azure Portal.</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com">Azure Portal</a> in your browser. If you are asked to sign in, do so with your Microsoft Account.</p>
</li>
<li>
<p>Click <strong>+ New</strong>, followed by <strong>Databases</strong> and <strong>Azure Cosmos DB</strong>.</p>
<p><a href="Images/portal-create-new-documentdb.png" target="_blank"><img src="Images/portal-create-new-documentdb.png" alt="Creating a Cosmos DB account" style="max-width:100%;"></a></p>
<p><em>Creating a Cosmos DB account</em></p>
</li>
<li>
<p>In the "Azure Cosmos DB" blade, give the account a unique name such as "documentdbhol" and make sure a green check mark appears next to it. (You can only use numbers and lowercase letters since the name becomes part of a DNS name.) Select <strong>SQL (DocumentDB)</strong> as the <strong>API</strong>. Then select <strong>Create new</strong> under <strong>Resource group</strong> and name the resource group "DocumentDBResourceGroup." Select the <strong>Location</strong> nearest you, and then click the <strong>Create</strong> button.</p>
<p><a href="Images/portal-configure-new-documentdb.png" target="_blank"><img src="Images/portal-configure-new-documentdb.png" alt="Specifying Cosmos DB parameters" style="max-width:100%;"></a></p>
<p><em>Specifying Cosmos DB parameters</em></p>
</li>
<li>
<p>Click <strong>Resource groups</strong> in the ribbon on the left side of the portal, and then click the resource group created for the Cosmos DB account.</p>
<p><a href="Images/open-resource-group.png" target="_blank"><img src="Images/open-resource-group.png" alt="Opening the resource group" style="max-width:100%;"></a></p>
<p><em>Opening the resource group</em></p>
</li>
<li>
<p>Wait until "Deploying" changes to "Succeeded," indicating that the Cosmos DB account has been deployed. You can click the <strong>Refresh</strong> button at the top of the blade to refresh the deployment status.</p>
<p><a href="Images/deployment-status.png" target="_blank"><img src="Images/deployment-status.png" alt="Viewing the deployment status" style="max-width:100%;"></a></p>
<p><em>Viewing the deployment status</em></p>
</li>
</ol>
<p>Your Cosmos DB account is now provisioned and ready for you to start working with it.</p>
<p><a name="Exercise2"></a></p>
<h2>Exercise 2: Create a DocumentDB database and collections</h2>
<p>Now that you’ve created a Cosmos DB account, the next step is to create a database and add collections to it in preparation for storing documents. In this exercise, you will create a database and add three collections to it for storing information about customers, products, and orders.</p>
<ol>
<li>
<p>Click the Cosmos DB account that you deployed in <a href="#Exercise1">Exercise 1</a>.</p>
<p><a href="Images/open-documentdb.png" target="_blank"><img src="Images/open-documentdb.png" alt="Opening the Cosmos DB account" style="max-width:100%;"></a></p>
<p><em>Opening the Cosmos DB account</em></p>
</li>
<li>
<p>Click <strong>+ Add Collection</strong>.</p>
<p><a href="Images/add-collection.png" target="_blank"><img src="Images/add-collection.png" alt="Adding a collection" style="max-width:100%;"></a></p>
<p><em>Adding a collection</em></p>
</li>
<li>
<p>Enter "Customers" (without quotation marks) as the <strong>Collection Id</strong> and make sure <strong>STORAGE CAPACITY</strong> is set to <strong>Fixed (10 GB)</strong>. Select <strong>Create New</strong> under <strong>DATABASE</strong> and specify "CustomerOrders" as the database name. Then click the <strong>OK</strong> button.</p>
<p><a href="Images/create-collection-and-database.png" target="_blank"><img src="Images/create-collection-and-database.png" alt="Creating a Customers collection" style="max-width:100%;"></a></p>
<p><em>Creating a Customers collection</em></p>
</li>
<li>
<p>Click <strong>+ Add Collection</strong> again. Fill in the form as shown below to create a second collection named "Orders." Be sure to add it to the existing database ("CustomerOrders") rather than create a new database. Then click <strong>OK</strong>.</p>
<p><a href="Images/add-orders-collection.png" target="_blank"><img src="Images/add-orders-collection.png" alt="Adding an Orders collection" style="max-width:100%;"></a></p>
<p><em>Adding an Orders collection</em></p>
</li>
<li>
<p>Click <strong>+ Add Collection</strong> again. Create a third collection named "Products" with the same settings as the "Customers" and "Orders" collections. Once more, be sure to add it to the existing database ("CustomerOrders") rather than create a new database.</p>
</li>
</ol>
<p>The next step is to upload documents containing data regarding customers, products, and orders to the collections you created.</p>
<p><a name="Exercise3"></a></p>
<h2>Exercise 3: Populate collections with documents</h2>
<p>There are several ways to populate DocumentDB collections with documents, including programmatic import via the <a href="https://www.nuget.org/packages/Microsoft.Azure.DocumentDB/">Azure SDK</a> and the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=46436">Microsoft DocumentDB Data Migration Tool</a>. In this exercise, you will populate your collections with data by uploading JSON documents through the Azure Portal.</p>
<ol>
<li>
<p>Click <strong>Document Explorer</strong> in the menu on the left. Make sure <strong>Customers</strong> is selected in the drop-down list of collections, and click <strong>Upload</strong>.</p>
<p><a href="Images/open-document-explorer.png" target="_blank"><img src="Images/open-document-explorer.png" alt="Opening Document Explorer" style="max-width:100%;"></a></p>
<p><em>Opening Document Explorer</em></p>
</li>
<li>
<p>Click the folder icon. Select all of the files in this lab's "Resources/Customers" folder, and then click the <strong>Upload</strong> button.</p>
<p><a href="Images/upload-customer-data.png" target="_blank"><img src="Images/upload-customer-data.png" alt="Uploading customer data" style="max-width:100%;"></a></p>
<p><em>Uploading customer data</em></p>
<p>Each of the files you uploaded is a JSON document containing information about one customer. Here is one of those files:</p>
<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>CustomerID<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ALFKI<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>CompanyName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Alfreds Futterkiste<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>ContactName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Maria Anders<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>ContactTitle<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Sales Representative<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Address<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Obere Str. 57<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>City<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Berlin<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Region<span class="pl-pds">"</span></span>: <span class="pl-c1">null</span>,
  <span class="pl-s"><span class="pl-pds">"</span>PostalCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>12209<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Latitude<span class="pl-pds">"</span></span>: <span class="pl-c1">52.54971</span>,
  <span class="pl-s"><span class="pl-pds">"</span>Longitude<span class="pl-pds">"</span></span>: <span class="pl-c1">13.49041</span>,
  <span class="pl-s"><span class="pl-pds">"</span>Country<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Germany<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Phone<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>030-0074321<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Fax<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>030-0076545<span class="pl-pds">"</span></span>
}</pre></div>
<p>There are 91 files in all, so the Customers collection is now populated with data for 91 customers.</p>
</li>
<li>
<p>Close the "Upload Document" blade and return to the "Document Explorer" blade. Select <strong>Orders</strong> from the drop-down list of collections and click <strong>Upload</strong>. Then upload all of the files in this lab's "Resources/Orders" folder to the Orders collection.</p>
</li>
<li>
<p>Repeat this process to upload all of the files in this lab's "Resources/Products" folder to the Products collection.</p>
</li>
<li>
<p>The next step is to validate the document uploads by querying one or more of the collections. Click <strong>Query Explorer</strong> in the menu on the left. Select <strong>Orders</strong> in the drop-down list of collections, and then click the <strong>Run Query</strong> button.</p>
<blockquote>
<p>Although you won't use DocumentDB's rich query capabilities directly in this lab, be aware that DocumentDB supports a variation of the SQL query language for extracting information from JSON data. For more information, and plenty of examples, see <a href="https://docs.microsoft.com/azure/documentdb/documentdb-sql-query">https://docs.microsoft.com/azure/documentdb/documentdb-sql-query</a>.</p>
</blockquote>
<p><a href="Images/open-query-explorer.png" target="_blank"><img src="Images/open-query-explorer.png" alt="Querying the Orders collection" style="max-width:100%;"></a></p>
<p><em>Querying the Orders collection</em></p>
</li>
<li>
<p>Confirm that you see the query results below.</p>
<p><a href="Images/query-results.png" target="_blank"><img src="Images/query-results.png" alt="Query results" style="max-width:100%;"></a></p>
<p><em>Query results</em></p>
</li>
<li>
<p>If you would like to confirm that the product and customer uploads succeeded too, run the same query against the Products and Customers collections.</p>
</li>
</ol>
<p>The database that you created now has three collections that are populated with data. Now let's index the data so searches can be performed quickly.</p>
<p><a name="Exercise4"></a></p>
<h2>Exercise 4: Connect Azure Search</h2>
<p>One of the benefits of using DocumentDB is that it integrates easily with <a href="https://azure.microsoft.com/services/search/">Azure Search</a>. Azure Search is a managed Search-as-a-Service solution that delegates server and infrastructure management to Microsoft and lets you index data sources for lightning-fast searches. Search can be accessed through a simple <a href="https://docs.microsoft.com/rest/api/searchservice/">REST API</a> or with the <a href="https://docs.microsoft.com/azure/search/search-howto-dotnet-sdk">Azure Search SDK</a>, enabling you to employ it in Web apps, mobile apps, and other types of applications. In this exercise, you will deploy an Azure Search service and connect it to the DocumentDB database that you created in <a href="#Exercise2">Exercise 2</a>.</p>
<ol>
<li>
<p>In the Azure Portal, click <strong>+ New</strong>, followed by <strong>Web + Mobile</strong> and then <strong>Azure Search</strong>.</p>
<p><a href="Images/portal-create-new-search-service.png" target="_blank"><img src="Images/portal-create-new-search-service.png" alt="Creating a new Azure Search service" style="max-width:100%;"></a></p>
<p><em>Creating a new Azure Search service</em></p>
</li>
<li>
<p>In the "New Search Service" blade, enter a unique name in the <strong>URL</strong> box and make sure a green check mark appears next to it. (You can only use numbers and lowercase letters since the name becomes part of a DNS name.) Place the service in the same resource group and location you chose for the Cosmos DB account in <a href="#Exercise1">Exercise 1</a>.</p>
<p>Now click <strong>Pricing tier</strong> and select the <strong>Free</strong> tier. Finish up by clicking the <strong>Select</strong> button at the bottom of the "Choose your pricing tier" blade, followed by the <strong>Create</strong> button at the bottom of the "New Search Service" blade.</p>
<p><a href="Images/portal-configure-new-search-service.png" target="_blank"><img src="Images/portal-configure-new-search-service.png" alt="Specifying Search parameters" style="max-width:100%;"></a></p>
<p><em>Specifying Search parameters</em></p>
</li>
<li>
<p>Click <strong>Resource groups</strong> in the ribbon on the left side of the portal, and then click the resource group containing the DocumentDB account and Search service.</p>
<p><a href="Images/open-resource-group.png" target="_blank"><img src="Images/open-resource-group.png" alt="Opening the resource group" style="max-width:100%;"></a></p>
<p><em>Opening the resource group</em></p>
</li>
<li>
<p>Wait until "Deploying" changes to "Succeeded," indicating that the Search service has been deployed. (You can click the <strong>Refresh</strong> button at the top of the blade to refresh the deployment status.) Then click the Search service.</p>
<p><a href="Images/open-search.png" target="_blank"><img src="Images/open-search.png" alt="Opening the Search service" style="max-width:100%;"></a></p>
<p><em>Opening the Search service</em></p>
</li>
<li>
<p>Click <strong>Import data</strong>.</p>
<p><a href="Images/portal-select-import-data.png" target="_blank"><img src="Images/portal-select-import-data.png" alt="Importing data" style="max-width:100%;"></a></p>
<p><em>Importing data</em></p>
</li>
<li>
<p>Click <strong>Data Source</strong>, followed by <strong>DocumentDB</strong>. In the "New data source" blade, type "customers" into the <strong>Name</strong> field. Click <strong>Select an account</strong> and select the Cosmos DB account you created in <a href="#Exercise1">Exercise 1</a>. Select the <strong>CustomerOrders</strong> database and the <strong>Customers</strong> collection. Then click <strong>OK</strong>.</p>
<p><a href="Images/portal-connect-search-datasource.png" target="_blank"><img src="Images/portal-connect-search-datasource.png" alt="Connecting to a data source" style="max-width:100%;"></a></p>
<p><em>Connecting to a data source</em></p>
</li>
<li>
<p>Click <strong>Customize target index</strong> in the "Import data" blade. In the "Index" blade, type "customerindex" (without quotation marks) into the <strong>Index name</strong> field, and check all five boxes in the CompanyName row. Then click <strong>OK</strong>.</p>
<p><a href="Images/portal-configure-search-index.png" target="_blank"><img src="Images/portal-configure-search-index.png" alt="Configuring a search index" style="max-width:100%;"></a></p>
<p><em>Configuring a search index</em></p>
</li>
<li>
<p>Click <strong>Import your data</strong> in the "Import data" blade. In the "Create an Indexer" blade, type "customerindexer" into the <strong>Name</strong> field and click <strong>OK</strong>. Finish up by clicking the <strong>OK</strong> button at the bottom of the "Import data" blade.</p>
<p><a href="Images/portal-configure-search-indexer.png" target="_blank"><img src="Images/portal-configure-search-indexer.png" alt="Configuring a search indexer" style="max-width:100%;"></a></p>
<p><em>Configuring a search indexer</em></p>
</li>
</ol>
<p>With the DocumentDB database deployed and an Azure Search service connected to it, it is time to put both to work by building a Web app that uses them to display customer, product, and order information.</p>
<p><a name="Exercise5"></a></p>
<h2>Exercise 5: Build a Web app</h2>
<p>In this exercise, you will build an ASP.NET MVC Web app with Visual Studio. The app will connect to the DocumentDB database you deployed and populated with data in previous exercises and provide a browser-based front-end for viewing and searching the data.</p>
<ol>
<li>
<p>Start Visual Studio and use the <strong>File -&gt; New -&gt; Project</strong> command to create a new Visual C# ASP.NET Web Application project named "AdventureDocs" (short for "Adventure Works Documents").</p>
<p><a href="Images/vs-create-new-web-app.png" target="_blank"><img src="Images/vs-create-new-web-app.png" alt="Creating a new Web Application project" style="max-width:100%;"></a></p>
<p><em>Creating a new Web Application project</em></p>
</li>
<li>
<p>In the ensuing dialog, make sure <strong>MVC</strong> is selected. Then click <strong>OK</strong>.</p>
<p><a href="Images/vs-configure-web-app.png" target="_blank"><img src="Images/vs-configure-web-app.png" alt="Configuring the project" style="max-width:100%;"></a></p>
<p><em>Configuring the project</em></p>
</li>
<li>
<p>Use Visual Studio's <strong>Debug -&gt; Start Without Debugging</strong> command (or simply press <strong>Ctrl+F5</strong>) to launch the application in your browser. Here's how the application looks in its present state:</p>
<p><a href="Images/vs-initial-application.png" target="_blank"><img src="Images/vs-initial-application.png" alt="The initial application" style="max-width:100%;"></a></p>
<p><em>The initial application</em></p>
</li>
<li>
<p>Close the browser and return to Visual Studio. In the Solution Explorer window, right-click the <strong>AdventureDocs</strong> project and select <strong>Manage NuGet Packages...</strong>. Click <strong>Browse</strong>. Then type "documentdb" (without quotation marks) into the search box. Click <strong>Microsoft.Azure.DocumentDB</strong> to select the Azure DocumentDB .NET Client Library from NuGet. Finally, click <strong>Install</strong> to install the latest stable version of the package. This package contains APIs for accessing Azure DocumentDB from .NET applications. OK any changes and accept any licenses presented to you.</p>
<p><a href="Images/vs-add-documentdb-package.png" target="_blank"><img src="Images/vs-add-documentdb-package.png" alt="Installing Microsoft.Azure.DocumentDB" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.Azure.DocumentDB</em></p>
</li>
<li>
<p>Repeat this process to add the NuGet package named <strong>Microsoft.Azure.Search</strong> to the project. This package contains APIs for accessing Azure Search from .NET applications. Once more, OK any changes and accept any licenses presented to you.</p>
<p><a href="Images/vs-add-search-package.png" target="_blank"><img src="Images/vs-add-search-package.png" alt="Installing Microsoft.Azure.Search" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.Azure.Search</em></p>
</li>
<li>
<p>Repeat this process to add the NuGet package named <strong>jQuery.UI.Combined</strong> to the project. This package contains APIs for jQuery user-interface elements. Once more, OK any changes and accept any licenses presented to you.</p>
<p><a href="Images/vs-add-jquery-package.png" target="_blank"><img src="Images/vs-add-jquery-package.png" alt="Installing jQuery.UI.Combined" style="max-width:100%;"></a></p>
<p><em>Installing jQuery.UI.Combined</em></p>
</li>
<li>
<p>Open <strong>Web.config</strong> and add the following statements to the <code>&lt;appSettings&gt;</code> section:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>DocumentDBEndpointUrl<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>DOCUMENTDB_ENDPOINT<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>DocumentDBKey<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>DOCUMENTDB_KEY<span class="pl-pds">"</span></span> /&gt;</pre></div>
</li>
<li>
<p>Return to the Azure Portal and open the blade for the Cosmos DB account that you created in <a href="#Exercise1">Exercise 1</a>. Click <strong>Keys</strong>. Then click <strong>Read-only Keys</strong>, and click the <strong>Copy</strong> button to the right of the <strong>URI</strong> box to copy the DocumentDB URI to the clipboard.</p>
<p><a href="Images/copy-documentdb-uri.png" target="_blank"><img src="Images/copy-documentdb-uri.png" alt="Copying the DocumentDB URI" style="max-width:100%;"></a></p>
<p><em>Copying the DocumentDB URI</em></p>
</li>
<li>
<p>Return to Visual Studio. In <strong>Web.config</strong>, replace DOCUMENTDB_ENDPOINT with the URI on the clipboard.</p>
</li>
<li>
<p>Return to the Azure Portal and click the <strong>Copy</strong> button to the right of <strong>PRIMARY READ-ONLY KEY</strong> to copy the access key the clipboard.</p>
</li>
<li>
<p>Return to Visual Studio. In <strong>Web.config</strong>, replace DOCUMENTDB_KEY with the key on the clipboard.</p>
</li>
<li>
<p>Open <strong>_Layout.cshtml</strong> in the project's "Views/Shared" folder. Then replace the file's contents with the following statements:</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>viewport<span class="pl-pds">"</span></span> <span class="pl-e">content</span>=<span class="pl-s"><span class="pl-pds">"</span>width=device-width, initial-scale=1.0<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">title</span>&gt;@ViewBag.Title&lt;/<span class="pl-ent">title</span>&gt;
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @Styles.Render("~/Content/css")
    @Styles.Render("~/Content/themes/base/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/jqueryui")
&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>navbar navbar-inverse navbar-fixed-top<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>navbar-header<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">button</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>button<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>navbar-toggle<span class="pl-pds">"</span></span> <span class="pl-e">data-toggle</span>=<span class="pl-s"><span class="pl-pds">"</span>collapse<span class="pl-pds">"</span></span> <span class="pl-e">data-target</span>=<span class="pl-s"><span class="pl-pds">"</span>.navbar-collapse<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>icon-bar<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">span</span>&gt;
                    &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>icon-bar<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">span</span>&gt;
                    &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>icon-bar<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">span</span>&gt;
                &lt;/<span class="pl-ent">button</span>&gt;
                @Html.ActionLink("AdventureDB", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
            &lt;/<span class="pl-ent">div</span>&gt;
            &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>navbar-collapse collapse<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">ul</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>nav navbar-nav<span class="pl-pds">"</span></span>&gt;
                    &lt;<span class="pl-ent">li</span>&gt;@Html.ActionLink("Document Search", "Index", "Home")&lt;/<span class="pl-ent">li</span>&gt;
                    &lt;<span class="pl-ent">li</span>&gt;@Html.ActionLink("Customer Lookup", "Lookup", "Home")&lt;/<span class="pl-ent">li</span>&gt;
                &lt;/<span class="pl-ent">ul</span>&gt;
            &lt;/<span class="pl-ent">div</span>&gt;
        &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container body-content<span class="pl-pds">"</span></span>&gt;
        @RenderBody()
        &lt;<span class="pl-ent">hr</span> /&gt;
        &lt;<span class="pl-ent">footer</span>&gt;
            &lt;<span class="pl-ent">p</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>text-muted<span class="pl-pds">"</span></span>&gt;All rights reserved. Copyright <span class="pl-c1">&amp;copy;</span>@DateTime.Now.Year AdventureDB.&lt;/<span class="pl-ent">p</span>&gt;
        &lt;/<span class="pl-ent">footer</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;

    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>
</li>
<li>
<p>Right-click the "Models" folder in Solution Explorer and use the <strong>Add -&gt; Class...</strong> command to add a class file named <strong>OrderInformation.cs</strong>. Then replace the empty <code>OrderInformation</code> class with the following class definitions:</p>
<div class="highlight highlight-source-cs"><pre>[Serializable]
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">OrderInformation</span>
{
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CustomerID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CompanyName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">Customer</span> <span class="pl-en">Customer</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Customer</span>
{
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CustomerID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CompanyName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ContactName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ContactTitle</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Address</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">City</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">object</span> <span class="pl-en">Region</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">PostalCode</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">Latitude</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">Longitude</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Country</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Phone</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Fax</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">Orders</span> <span class="pl-en">Orders</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Orders</span>
{
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">OrderID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CustomerID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">EmployeeID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">DateTime</span> <span class="pl-en">OrderDate</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">DateTime</span> <span class="pl-en">RequiredDate</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">DateTime</span> <span class="pl-en">ShippedDate</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">ShipVia</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">float</span> <span class="pl-en">Freight</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ShipName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ShipAddress</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ShipCity</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">object</span> <span class="pl-en">ShipRegion</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ShipPostalCode</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ShipCountry</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">Details</span> <span class="pl-en">Details</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Details</span>
{
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">OrderID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">ProductID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">Quantity</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">float</span> <span class="pl-en">Discount</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">Product</span> <span class="pl-en">Product</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}

<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Product</span>
{
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">ProductID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">ProductName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">SupplierID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">CategoryID</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">QuantityPerUnit</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">UnitPrice</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">UnitsInStock</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">UnitsOnOrder</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">int</span> <span class="pl-en">ReorderLevel</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">bool</span> <span class="pl-en">Discontinued</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>
</li>
<li>
<p>Right-click the "Models" folder again and use the <strong>Add -&gt; Class...</strong> command to add a file named <strong>SearchResultInformation.cs</strong> to the folder. Replace the empty <code>SearchResultInformation</code> class with the following class definition:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">SearchResultInformation</span>
{
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Title</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">Description</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">DocumentContent</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>
</li>
<li>
<p>Repeat this process to add an <code>OrderViewModel</code> class to the "Models" folder, and replace the empty class with the following class definition:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">OrderViewModel</span>
{
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">SearchQuery</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">SearchResults</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">Collections</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">SelectedCollectionName</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">SearchResultTitle</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
    <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">SearchResultDescription</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
}</pre></div>
</li>
<li>
<p>In the Solution Explorer window, right-click the <strong>AdventureDocs</strong> project and use the <strong>Add -&gt; New Folder</strong> command to add a folder named "Helpers" to the project.</p>
</li>
<li>
<p>Right-click the "Helpers" folder and use the <strong>Add -&gt; Class...</strong> command to add a file named <strong>DocumentHelper.cs</strong> to the folder. Replace the contents of the file with the following statements:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>; 
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Azure.Documents</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Azure.Documents.Client</span>;
<span class="pl-k">using</span> <span class="pl-en">Newtonsoft.Json</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">AdventureDocs.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Configuration</span>;

<span class="pl-k">namespace</span> <span class="pl-en">AdventureDocs.Helpers</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DocumentHelper</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">DocumentClient</span> <span class="pl-en">GetDocumentClient</span>()
        {
            <span class="pl-k">string</span> <span class="pl-en">endpointUrl</span> = ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>DocumentDBEndpointUrl<span class="pl-pds">"</span></span>];
            <span class="pl-k">string</span> <span class="pl-en">primaryKey</span> = ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>DocumentDBKey<span class="pl-pds">"</span></span>];
            <span class="pl-en">DocumentClient</span> <span class="pl-en">client</span> = <span class="pl-k">new</span> <span class="pl-en">DocumentClient</span>(<span class="pl-k">new</span> <span class="pl-en">Uri</span>(<span class="pl-en">endpointUrl</span>), primaryKey);
            <span class="pl-k">return</span> client;
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetAvailableCollectionNamesAsync</span>(<span class="pl-en">DocumentClient</span> <span class="pl-smi">client</span>)
        {
            <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">collections</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;();

            <span class="pl-k">try</span>
            {
                <span class="pl-k">var</span> <span class="pl-en">dbFeed </span>= <span class="pl-k">await</span> client.ReadDatabaseFeedAsync();
                <span class="pl-k">var</span> <span class="pl-en">defaultDb </span>= dbFeed.FirstOrDefault();

                <span class="pl-k">if</span> (defaultDb != <span class="pl-c1">null</span>)
                {
                    <span class="pl-en">FeedResponse</span>&lt;<span class="pl-en">DocumentCollection</span>&gt; <span class="pl-en">collFeed</span> = <span class="pl-k">await</span> client.ReadDocumentCollectionFeedAsync(defaultDb.SelfLink);

                    collections = (<span class="pl-k">from</span> feed <span class="pl-k">in</span> collFeed <span class="pl-k">select</span> feed.Id).ToList();
                }
            }
            <span class="pl-k">catch</span> (<span class="pl-en">Exception</span>)
            {
            }

            <span class="pl-k">return</span> collections;
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">GetOrdersByOrder</span>(<span class="pl-en">DocumentClient</span> <span class="pl-smi">client</span>, <span class="pl-k">string</span> <span class="pl-smi">countryName</span>)
        {
            <span class="pl-en">FeedOptions</span> <span class="pl-en">queryOptions</span> = <span class="pl-k">new</span> <span class="pl-en">FeedOptions</span> { MaxItemCount = -<span class="pl-c1">1</span> };

            <span class="pl-en">IQueryable</span>&lt;<span class="pl-en">OrderInformation</span>&gt; <span class="pl-en">orderQuery</span> = client.CreateDocumentQuery&lt;OrderInformation&gt;(
                    UriFactory.CreateDocumentCollectionUri(<span class="pl-s"><span class="pl-pds">"</span>CustomerOrders<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Orders<span class="pl-pds">"</span></span>), queryOptions)
                    .Where(f =&gt; f.Customer.Orders.ShipCountry.ToLower().StartsWith(countryName.ToLower()));

            <span class="pl-k">var</span> <span class="pl-en">orderItems </span>= orderQuery.ToList();

            <span class="pl-k">var</span> <span class="pl-en">results </span>= (<span class="pl-k">from</span> item <span class="pl-k">in</span> orderItems
                           <span class="pl-k">select</span> <span class="pl-k">new</span> <span class="pl-en">SearchResultInformation</span>()
                           {
                               Title = item.Customer.CompanyName,
                               Description = item.Customer.Orders.ShipCountry,
                               DocumentContent = JsonConvert.SerializeObject(item),

                           }).ToList();


            <span class="pl-k">return</span> results.Select(r =&gt; r.Title).Distinct().Select(title =&gt; results.First(r =&gt; r.Title == title)).ToList();
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">GetOrdersByCustomer</span>(<span class="pl-en">DocumentClient</span> <span class="pl-smi">client</span>, <span class="pl-k">string</span> <span class="pl-smi">companyName</span>)
        {
            <span class="pl-en">FeedOptions</span> <span class="pl-en">queryOptions</span> = <span class="pl-k">new</span> <span class="pl-en">FeedOptions</span> { MaxItemCount = -<span class="pl-c1">1</span> };

            <span class="pl-en">IQueryable</span>&lt;<span class="pl-en">OrderInformation</span>&gt; <span class="pl-en">orderQuery</span> = client.CreateDocumentQuery&lt;OrderInformation&gt;(
                    UriFactory.CreateDocumentCollectionUri(<span class="pl-s"><span class="pl-pds">"</span>CustomerOrders<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Orders<span class="pl-pds">"</span></span>), queryOptions)
                     .Where(f =&gt; f.Customer.CompanyName.ToLower().StartsWith(companyName.ToLower()));


            <span class="pl-k">var</span> <span class="pl-en">orderItems </span>= orderQuery.ToList();

            <span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">results</span> = (<span class="pl-k">from</span> item <span class="pl-k">in</span> orderItems
                                                     <span class="pl-k">select</span> <span class="pl-k">new</span> <span class="pl-en">SearchResultInformation</span>()
                                                     {
                                                         Title = item.Customer.CompanyName,
                                                         Description = item.Customer.Country,
                                                         DocumentContent = JsonConvert.SerializeObject(item),

                                                     }).ToList();

            <span class="pl-k">return</span> results.Select(r =&gt; r.Title).Distinct().Select(title =&gt; results.First(r =&gt; r.Title == title)).ToList();
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">GetOrdersByProduct</span>(<span class="pl-en">DocumentClient</span> <span class="pl-smi">client</span>, <span class="pl-k">string</span> <span class="pl-smi">productName</span>)
        {
            <span class="pl-en">FeedOptions</span> <span class="pl-en">queryOptions</span> = <span class="pl-k">new</span> <span class="pl-en">FeedOptions</span> { MaxItemCount = -<span class="pl-c1">1</span> };

            <span class="pl-en">IQueryable</span>&lt;<span class="pl-en">OrderInformation</span>&gt; <span class="pl-en">orderQuery</span> = client.CreateDocumentQuery&lt;OrderInformation&gt;(
                    UriFactory.CreateDocumentCollectionUri(<span class="pl-s"><span class="pl-pds">"</span>CustomerOrders<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Orders<span class="pl-pds">"</span></span>), queryOptions)
                    .Where(f =&gt; f.Customer.Orders.Details.Product.ProductName.ToLower().StartsWith(productName.ToLower()));

            <span class="pl-k">var</span> <span class="pl-en">orderItems </span>= orderQuery.ToList();

            <span class="pl-k">var</span> <span class="pl-en">results </span>= (<span class="pl-k">from</span> item <span class="pl-k">in</span> orderItems
                           <span class="pl-k">select</span> <span class="pl-k">new</span> <span class="pl-en">SearchResultInformation</span>()
                           {
                               Title = item.Customer.Orders.Details.Product.ProductName,
                               Description = item.Customer.Orders.Details.Product.QuantityPerUnit,
                               DocumentContent = JsonConvert.SerializeObject(item),

                           }).ToList();


            <span class="pl-k">return</span> results.Select(r =&gt; r.Title).Distinct().Select(title =&gt; results.First(r =&gt; r.Title == title)).ToList();
        }
    }
}</pre></div>
</li>
<li>
<p>Open <strong>HomeController.cs</strong> in the project's "Controllers" folder. Add the following <code>using</code> statements to the top of the file:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">AdventureDocs.Models</span>;</pre></div>
</li>
<li>
<p>Replace the <code>Index</code> method in <strong>HomeController.cs</strong> with the following implementation:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">ActionResult</span>&gt; <span class="pl-en">Index</span>()
{
    <span class="pl-k">var</span> <span class="pl-en">model </span>= <span class="pl-k">new</span> <span class="pl-en">OrderViewModel</span>() { SearchResults = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;SearchResultInformation&gt;() };
    <span class="pl-k">var</span> <span class="pl-en">documentClient </span>= Helpers.DocumentHelper.GetDocumentClient();
    <span class="pl-k">var</span> <span class="pl-en">availableCollections </span>= <span class="pl-k">await</span> Helpers.DocumentHelper.GetAvailableCollectionNamesAsync(documentClient);
    <span class="pl-k">var</span> <span class="pl-en">searchResults </span>= (List&lt;SearchResultInformation&gt;)TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchResults<span class="pl-pds">"</span></span>];
    <span class="pl-k">var</span> <span class="pl-en">searchQuery </span>= (<span class="pl-k">string</span>)Request[<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span>];

    <span class="pl-k">if</span> (searchResults != <span class="pl-c1">null</span>)
    {
        model.SearchQuery = (<span class="pl-k">string</span>)TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span>];
        model.SearchResults = (List&lt;SearchResultInformation&gt;)TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchResults<span class="pl-pds">"</span></span>];
        model.SelectedCollectionName = (<span class="pl-k">string</span>)TempData[<span class="pl-s"><span class="pl-pds">"</span>SelectedCollectionName<span class="pl-pds">"</span></span>];
        model.SearchResultTitle = <span class="pl-pds">$"</span>{model.SelectedCollectionName}<span class="pl-pds">"</span>;
        model.SearchResultDescription = <span class="pl-pds">$"</span><span class="pl-s">The following results were found in </span>{model.SelectedCollectionName}<span class="pl-s"> for '</span>{model.SearchQuery.ToUpper()}<span class="pl-s">':</span><span class="pl-pds">"</span>;
    }
    <span class="pl-k">else</span> <span class="pl-k">if</span> (!<span class="pl-k">string</span>.IsNullOrEmpty(searchQuery))
    {
        model.SearchQuery = searchQuery;
        searchResults = Helpers.DocumentHelper.GetOrdersByCustomer(documentClient, searchQuery);
        model.SearchResults = searchResults;
        model.SelectedCollectionName = <span class="pl-s"><span class="pl-pds">"</span>Customers<span class="pl-pds">"</span></span>;
        model.SearchResultTitle = <span class="pl-pds">$"</span>{model.SelectedCollectionName}<span class="pl-pds">"</span>;
        model.SearchResultDescription = <span class="pl-pds">$"</span><span class="pl-s">The following results were found in </span>{model.SelectedCollectionName}<span class="pl-s"> for '</span>{model.SearchQuery.ToUpper()}<span class="pl-s">':</span><span class="pl-pds">"</span>;
    }
    <span class="pl-k">else</span>
    {
        model.SearchQuery = <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
        model.SelectedCollectionName = <span class="pl-s"><span class="pl-pds">"</span>Customers<span class="pl-pds">"</span></span>;
        model.SearchResultTitle = <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
        model.SearchResultDescription = <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    }

    model.Collections = availableCollections;
    <span class="pl-k">return</span> View(model);
}
</pre></div>
</li>
<li>
<p>Add the following methods to the <code>HomeController</code> class in <strong>HomeController.cs</strong>:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Lookup</span>()
{
    ViewBag.Message = <span class="pl-s"><span class="pl-pds">"</span>Your application description page.<span class="pl-pds">"</span></span>;
    <span class="pl-k">return</span> View();
}
      
[HttpGet]
<span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">ViewSource</span>(<span class="pl-k">string</span>[] <span class="pl-smi">content</span>)
{
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">JsonResult</span>
    {
        JsonRequestBehavior = JsonRequestBehavior.AllowGet,
        Data = content[<span class="pl-c1">0</span>]
    };
}

[HttpPost]
<span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Search</span>(<span class="pl-en">OrderViewModel</span> <span class="pl-smi">model</span>)
{
    ViewBag.Message = <span class="pl-s"><span class="pl-pds">"</span>Your application description page.<span class="pl-pds">"</span></span>;
    <span class="pl-k">string</span> <span class="pl-en">searchQuery</span> = model.SearchQuery + <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-k">var</span> <span class="pl-en">documentClient </span>= Helpers.DocumentHelper.GetDocumentClient();
    <span class="pl-en">List</span>&lt;<span class="pl-en">SearchResultInformation</span>&gt; <span class="pl-en">searchResults</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;SearchResultInformation&gt;();

    <span class="pl-k">switch</span> (model.SelectedCollectionName)
    {
        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>Customers<span class="pl-pds">"</span></span>:
            searchResults = Helpers.DocumentHelper.GetOrdersByCustomer(documentClient, searchQuery);
            <span class="pl-k">break</span>;
        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>Products<span class="pl-pds">"</span></span>:
            searchResults = Helpers.DocumentHelper.GetOrdersByProduct(documentClient, searchQuery);
            <span class="pl-k">break</span>;
        <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>Orders<span class="pl-pds">"</span></span>:
            searchResults = Helpers.DocumentHelper.GetOrdersByOrder(documentClient, searchQuery);
            <span class="pl-k">break</span>;
        <span class="pl-k">default</span>:
            <span class="pl-k">break</span>;
    }

    TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span>] = searchQuery;
    TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchResults<span class="pl-pds">"</span></span>] = searchResults;
    TempData[<span class="pl-s"><span class="pl-pds">"</span>SelectedCollectionName<span class="pl-pds">"</span></span>] = model.SelectedCollectionName;

    <span class="pl-k">return</span> RedirectToAction(<span class="pl-s"><span class="pl-pds">"</span>Index<span class="pl-pds">"</span></span>);
}</pre></div>
</li>
<li>
<p>Open <strong>Index.cshmtl</strong> in the "Views/Home" folder and replace its contents with the following statements:</p>
<div class="highlight highlight-text-html-basic"><pre>@{
    ViewBag.Title = "AdventureDocs";
}

&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>row<span class="pl-pds">"</span></span>&gt;
    @model AdventureDocs.Models.OrderViewModel
    &lt;<span class="pl-ent">div</span>&gt;
        &lt;<span class="pl-ent">h2</span>&gt;Document Search&lt;/<span class="pl-ent">h2</span>&gt;
        &lt;<span class="pl-ent">p</span>&gt;
            To search documents in your Azure DocumentDB database, enter a value, select a DocumentDB collection, and click Search.
        &lt;/<span class="pl-ent">p</span>&gt;

        @using (Html.BeginForm("Search", "Home", FormMethod.Post))
        {
            &lt;<span class="pl-ent">div</span>&gt;Search for:&lt;/<span class="pl-ent">div</span>&gt;
            @Html.TextBoxFor(o =&gt; Model.SearchQuery)
            &lt;<span class="pl-ent">p</span>&gt;&lt;/<span class="pl-ent">p</span>&gt;
            &lt;<span class="pl-ent">div</span>&gt;Select a collection:&lt;/<span class="pl-ent">div</span>&gt;
            @Html.DropDownListFor(x =&gt; x.SelectedCollectionName, new SelectList(Model.Collections))
            &lt;<span class="pl-ent">input</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>Search<span class="pl-pds">"</span></span>&gt;
        }

        &lt;<span class="pl-ent">div</span>&gt;
            &lt;<span class="pl-ent">h4</span>&gt;@Html.DisplayFor(o =&gt; Model.SearchResultTitle)&lt;/<span class="pl-ent">h4</span>&gt;
            &lt;<span class="pl-ent">div</span>&gt;@Html.DisplayFor(o =&gt; Model.SearchResultDescription)&lt;/<span class="pl-ent">div</span>&gt;
            &lt;<span class="pl-ent">table</span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>margin:10px<span class="pl-pds">"</span></span> <span class="pl-e">border</span>=<span class="pl-s"><span class="pl-pds">"</span>0<span class="pl-pds">"</span></span> <span class="pl-e">cellpadding</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span>&gt;
                @foreach (var item in Model.SearchResults)
                {
                    &lt;<span class="pl-ent">tr</span>&gt;
                        &lt;<span class="pl-ent">td</span>&gt;
                            &lt;<span class="pl-ent">strong</span>&gt;@Html.DisplayFor(modelItem =&gt; item.Title)&lt;/<span class="pl-ent">strong</span>&gt;
                        &lt;/<span class="pl-ent">td</span>&gt;
                        &lt;<span class="pl-ent">td</span>&gt;
                            &lt;<span class="pl-ent">em</span>&gt;@Html.DisplayFor(modelItem =&gt; item.Description)&lt;/<span class="pl-ent">em</span>&gt;
                        &lt;/<span class="pl-ent">td</span>&gt;

                        &lt;<span class="pl-ent">td</span>&gt;
                            @Html.ActionLink(
                            linkText: "[view document]",
                            actionName: "ViewSource",
                            controllerName: "Home",
                            routeValues: new { content = item.DocumentContent },
                            htmlAttributes: null)
                        &lt;/<span class="pl-ent">td</span>&gt;
                    &lt;/<span class="pl-ent">tr</span>&gt;
                }
            &lt;/<span class="pl-ent">table</span>&gt;
        &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>
</li>
<li>
<p>Find <strong>About.cshmtl</strong> in the "Views/Home" folder. Right-click the file and use the <strong>Rename</strong> command to change its name to <strong>Lookup.cshtml</strong>. This is the view that will serve as the document lookup page.</p>
</li>
<li>
<p>Replace the contents of <strong>Lookup.cshtml</strong> with the following statements:</p>
<div class="highlight highlight-text-html-basic"><pre>@Scripts.Render("~/bundles/jqueryui")

&lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span>&gt;<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-en">$</span>(<span class="pl-c1">document</span>).<span class="pl-en">ready</span>(<span class="pl-k">function</span> () {</span>
<span class="pl-s1"> </span>
<span class="pl-s1">        <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">'</span>#customers<span class="pl-pds">'</span></span>).<span class="pl-en">autocomplete</span>({</span>
<span class="pl-s1">            source<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>@Url.Action("Suggest")<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            autoFocus<span class="pl-k">:</span> <span class="pl-c1">true</span>,</span>
<span class="pl-s1">            <span class="pl-en">select</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-c1">event</span>, <span class="pl-smi">ui</span>) {</span>
<span class="pl-s1"></span>
<span class="pl-s1">                <span class="pl-k">if</span> (<span class="pl-smi">ui</span>.<span class="pl-smi">item</span>) {</span>
<span class="pl-s1">                    <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">"</span>#SearchQuery<span class="pl-pds">"</span></span>).<span class="pl-en">val</span>(<span class="pl-smi">ui</span>.<span class="pl-smi">item</span>.<span class="pl-c1">value</span>);</span>
<span class="pl-s1">                    <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">"</span>form<span class="pl-pds">"</span></span>).<span class="pl-c1">submit</span>();</span>
<span class="pl-s1">                }</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        }); </span>
<span class="pl-s1">    })</span>
<span class="pl-s1"></span><span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;

&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>row<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-md-4<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">h2</span>&gt;Customer Lookup&lt;/<span class="pl-ent">h2</span>&gt;
        &lt;<span class="pl-ent">p</span>&gt;
            To search documents in your Azure DocumentDB database, enter a value and select an autosuggested customer.
        &lt;/<span class="pl-ent">p</span>&gt;
        &lt;<span class="pl-ent">div</span>&gt;Search for:&lt;/<span class="pl-ent">div</span>&gt;
        &lt;<span class="pl-ent">input</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>customers<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>customers<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">form</span> <span class="pl-e">action</span>=<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> <span class="pl-e">method</span>=<span class="pl-s"><span class="pl-pds">"</span>post<span class="pl-pds">"</span></span>&gt;
            &lt;<span class="pl-ent">input</span> <span class="pl-e">hidden</span>=<span class="pl-s"><span class="pl-pds">"</span>hidden<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span> /&gt;
        &lt;/<span class="pl-ent">form</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">style</span>=<span class="pl-s"><span class="pl-pds">"</span>height:400px<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-md-4<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>
</li>
<li>
<p>Open <strong>BundleConfig.cs</strong> in the project's "App_Start" folder. Add the following code at the end of the <code>RegisterBundles</code> method:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-en">bundles.Add</span>(new <span class="pl-en">ScriptBundle</span>(<span class="pl-s"><span class="pl-pds">"</span>~/bundles/jqueryui<span class="pl-pds">"</span></span>).<span class="pl-en">Include</span>(<span class="pl-s"><span class="pl-pds">"</span>~/Scripts/jquery-ui-{version}.js<span class="pl-pds">"</span></span>));
<span class="pl-en">bundles.Add</span>(new <span class="pl-en">StyleBundle</span>(<span class="pl-s"><span class="pl-pds">"</span>~/Content/themes/base/css<span class="pl-pds">"</span></span>).<span class="pl-en">Include</span>(
            <span class="pl-s"><span class="pl-pds">"</span>~/Content/themes/base/jquery.ui.core.css<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>~/Content/themes/base/jquery.ui.autocomplete.css<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>~/Content/themes/base/jquery.ui.theme.css<span class="pl-pds">"</span></span>));</pre></div>
</li>
<li>
<p>Use Visual Studio's <strong>Debug -&gt; Start Without Debugging</strong> command (or press <strong>Ctrl+F5</strong>) to launch the application in your browser.</p>
</li>
<li>
<p><strong>Type</strong> the letter "a" in the <strong>Search for</strong> box and click the <strong>Search</strong> button. Confirm that a list of customer names starting with A appears on the page:</p>
<p><a href="Images/vs-documentsearch-01.png" target="_blank"><img src="Images/vs-documentsearch-01.png" alt="Searching for customer names that begin with A" style="max-width:100%;"></a></p>
<p><em>Searching for customer names that begin with A</em></p>
</li>
<li>
<p>Select <strong>Products</strong> from the list of collections and click the <strong>Search</strong> button. Confirm that a list of product names starting with A appears on the page:</p>
<p><a href="Images/vs-documentsearch-02.png" target="_blank"><img src="Images/vs-documentsearch-02.png" alt="Searching for product names that begin with A" style="max-width:100%;"></a></p>
<p><em>Searching for product names that begin with A</em></p>
</li>
<li>
<p>Replace the letter "a" in the <strong>Search for</strong> box with the letter "m." Then select <strong>Orders</strong> and click the <strong>Search</strong> button. Confirm that a list of orders appears, with the countries they were shipped to listed on the right:</p>
<p><a href="Images/vs-documentsearch-03.png" target="_blank"><img src="Images/vs-documentsearch-03.png" alt="Searching for orders shipped to countries that begin with M" style="max-width:100%;"></a></p>
<p><em>Searching for orders shipped to countries that begin with M</em></p>
</li>
<li>
<p>The Orders listing displays the CompanyName and ShipRegion values from the orders returned in the search results. To view the entire order, click <strong>[view document]</strong> to the right of an order. The result is the JSON defining the order:</p>
<p><a href="Images/vs-documentsearch-04.png" target="_blank"><img src="Images/vs-documentsearch-04.png" alt="Viewing the JSON for an order" style="max-width:100%;"></a></p>
<p><em>Viewing the JSON for an order</em></p>
</li>
</ol>
<p>This is a great start, and it demonstrates how an ASP.NET MVC Web app can access data stored in the cloud in a DocumentDB database. But right now, the search UI is somewhat clumsy; you have to enter letters blindly, without any feedback to tell you whether there are any matching documents. Let's enhance the UI by adding auto-suggest.</p>
<p><a name="Exercise6"></a></p>
<h2>Exercise 6: Add auto-suggest</h2>
<p>Azure Search enables super-fast retrieval of indexed values in the data stores it is connected to. In this exercise, you will leverage that speed to add an auto-suggest list to customer search to provide feedback to the user as he or she types.</p>
<ol>
<li>
<p>Return to Visual Studio. Right-click the "Helpers" folder and use the <strong>Add -&gt; Class...</strong> command to add a file named <strong>SearchHelper.cs</strong> to the folder. Replace the contents of the file with the following statements:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft.Azure.Search</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Azure.Search.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Web</span>;
<span class="pl-k">using</span> <span class="pl-en">AdventureDocs.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Configuration</span>;

<span class="pl-k">namespace</span> <span class="pl-en">AdventureDocs.Helpers</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">SearchHelper</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">GetSuggestions</span>(<span class="pl-k">string</span> <span class="pl-smi">query</span>)
        {
            <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">suggestions</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;();

            <span class="pl-k">string</span> <span class="pl-en">searchServiceName</span> = ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>SearchServiceName<span class="pl-pds">"</span></span>];
            <span class="pl-k">string</span> <span class="pl-en">searchServiceKey</span> = ConfigurationManager.AppSettings[<span class="pl-s"><span class="pl-pds">"</span>SearchServiceKey<span class="pl-pds">"</span></span>];

            <span class="pl-en">SearchServiceClient</span> <span class="pl-en">serviceClient</span> = <span class="pl-k">new</span> <span class="pl-en">SearchServiceClient</span>(searchServiceName, <span class="pl-k">new</span> <span class="pl-en">SearchCredentials</span>(<span class="pl-en">searchServiceKey</span>));
            <span class="pl-en">ISearchIndexClient</span> <span class="pl-en">indexClient</span> = serviceClient.Indexes.GetClient(<span class="pl-s"><span class="pl-pds">"</span>customerindex<span class="pl-pds">"</span></span>);
            <span class="pl-en">DocumentSearchResult</span>&lt;<span class="pl-en">Customer</span>&gt; <span class="pl-en">response</span> = indexClient.Documents.Search&lt;Customer&gt;(<span class="pl-pds">$"</span>{query.Trim()}<span class="pl-s">*</span><span class="pl-pds">"</span>);

            suggestions = (<span class="pl-k">from</span> result <span class="pl-k">in</span> response.Results
                           <span class="pl-k">select</span> result.Document.CompanyName).ToList();

            <span class="pl-k">return</span> suggestions;
        }
    }
}</pre></div>
</li>
<li>
<p>Open <strong>Web.config</strong> and add the following statements to the <code>&lt;appSettings&gt;</code> section, replacing SEARCH_SERVICE_NAME with the name you assigned to the Azure Search service in Exercise 4, Step 2:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>SearchServiceName<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>SEARCH_SERVICE_NAME<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>SearchServiceKey<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>SEARCH_SERVICE_KEY<span class="pl-pds">"</span></span> /&gt;</pre></div>
</li>
<li>
<p>Return to the Azure Portal and open the blade for the Azure Search service. Click <strong>Keys</strong>, followed by <strong>Manage query keys</strong>. Then copy the query key to the clipboard.</p>
<blockquote>
<p>The purpose of query keys is to allow applications to query the Search service and to do so securely.</p>
</blockquote>
<p><a href="Images/portal-copy-search-query-key.png" target="_blank"><img src="Images/portal-copy-search-query-key.png" alt="Copying the query key to the clipboard" style="max-width:100%;"></a></p>
<p><em>Copying the query key to the clipboard</em></p>
</li>
<li>
<p>Return to Visual Studio. In <strong>Web.config</strong>, replace SEARCH_SERVICE_KEY with the query key on the clipboard.</p>
</li>
<li>
<p>Add the following methods to the <code>HomeController</code> class in <strong>HomeController.cs</strong>:</p>
<div class="highlight highlight-source-cs"><pre>[HttpPost]
<span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">AutoSearch</span>(<span class="pl-k">string</span> <span class="pl-smi">item</span>)
{
    ViewBag.Message = <span class="pl-s"><span class="pl-pds">"</span>Your application description page.<span class="pl-pds">"</span></span>;

    <span class="pl-k">string</span> <span class="pl-en">searchQuery</span> = item + <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;

    TempData[<span class="pl-s"><span class="pl-pds">"</span>SearchQuery<span class="pl-pds">"</span></span>] = searchQuery;
    TempData[<span class="pl-s"><span class="pl-pds">"</span>SelectedCollectionName<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>Customers<span class="pl-pds">"</span></span>;

    <span class="pl-k">return</span> RedirectToAction(<span class="pl-s"><span class="pl-pds">"</span>Index<span class="pl-pds">"</span></span>);
}

[HttpGet]
<span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Suggest</span>(<span class="pl-k">string</span> <span class="pl-smi">term</span>)
{
    <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">suggestions</span> = <span class="pl-k">new</span> <span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;();

    suggestions = Helpers.SearchHelper.GetSuggestions(term);

    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">JsonResult</span>
    {
        JsonRequestBehavior = JsonRequestBehavior.AllowGet,
        Data = suggestions
    };
}</pre></div>
</li>
<li>
<p>Use Visual Studio's <strong>Debug -&gt; Start Without Debugging</strong> command (or press <strong>Ctrl+F5</strong>) to launch the application in your browser.</p>
</li>
<li>
<p>Click <strong>Customer Lookup</strong>. Then type "ar" into the <strong>Search for</strong> box and wait for a list of suggested customers to appear.</p>
<p><a href="Images/vs-view-autosuggest.png" target="_blank"><img src="Images/vs-view-autosuggest.png" alt="Auto-suggest in action" style="max-width:100%;"></a></p>
<p><em>Auto-suggest in action</em></p>
</li>
<li>
<p>Select <strong>Around the Horn</strong> and press <strong>Enter</strong> to search for customers named "Around the Horn."</p>
</li>
</ol>
<p>Auto-suggest vastly improves the search experience and is relatively easy to add thanks to some of the classes you imported in NuGet packages in <a href="#Exercise5">Exercise 5</a>.</p>
<p><a name="Summary"></a></p>
<h2>Summary</h2>
<p>In this hands-on lab you learned how to:</p>
<ul>
<li>Create an Azure Cosmos DB account</li>
<li>Create DocumentDB collections and populate them with documents</li>
<li>Create an Azure Search service and and use it to index DocumentDB data</li>
<li>Access DocumentDB collections from your apps</li>
<li>Query the Azure Search service connected to a DocumentDB database</li>
</ul>
<p>Not surprisingly, there is much more you can do to leverage the power of the DocumentDB API. Experiment with other DocumentDB features, especially <a href="https://docs.microsoft.com/en-us/azure/documentdb/documentdb-programming">triggers, stored procedures, and user-defined functions</a>, and identify other ways you can enhance your data and search strategies by integrating Azure Cosmos DB and the DocumentDB API into your application ecosystems.</p>
<hr>
<p>Copyright 2017 Microsoft Corporation. All rights reserved. Except where otherwise noted, these materials are licensed under the terms of the MIT License. You may use them according to the license as is most appropriate for your project. The terms of this license can be found at <a href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a>.</p>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
